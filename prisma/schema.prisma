generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String   
  fullName      String?
  refreshToken  String?
  
  device        Device?  

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Device {
  id            String   @id @default(uuid())
  name          String
  serialNumber  String   @unique
  
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  
  sensorData    SensorData[]
  actionLogs    ActionLog[]
  automations   AutomationRule[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model SensorData {
  id           Int      @id @default(autoincrement())
  
  timestamp    DateTime @default(now()) 
  
  temperature  Float?   @default(0)
  humidity     Float?   @default(0)
  soilMoisture Float?   @default(0)
  lightLevel   Float?   @default(0)
  tankLevel   Float?   @default(0)

  count        Int      @default(1)

  deviceId     String
  device       Device   @relation(fields: [deviceId], references: [id])
  
  @@unique([deviceId, timestamp]) 
  @@index([timestamp])
}

model ActionLog {
  id          Int      @id @default(autoincrement())
  timestamp   DateTime @default(now())
  
  type        String
  action      String
  details     String?
  
  deviceId     String
  device       Device   @relation(fields: [deviceId], references: [id])
}

model AutomationRule {
  id              Int      @id @default(autoincrement())
  name            String
  isActive        Boolean  @default(true)
  
  triggerSensor   String
  condition       String
  threshold       Float
  
  actionPayload   String
  
  lastTriggered   DateTime?
  cooldownSeconds Int      @default(300)

  deviceId     String
  device       Device   @relation(fields: [deviceId], references: [id])
}

model SystemConfig {
  key         String   @id
  value       String
  description String?
}